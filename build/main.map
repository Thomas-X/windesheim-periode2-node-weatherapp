{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///external \"chalk\"","webpack:///external \"express\"","webpack:///external \"convert-units\"","webpack:///external \"ip\"","webpack:///external \"body-parser\"","webpack:///external \"cors\"","webpack:///external \"http\"","webpack:///external \"stack-trace\"","webpack:///external \"cheerio\"","webpack:///external \"axios\"","webpack:///external \"puppeteer\"","webpack:///external \"fs\"","webpack:///external \"path\"","webpack:///external \"dotenv\"","webpack:///./src/services/log.js","webpack:///./src/controllers/home.js","webpack:///./src/controllers/api.js","webpack:///./src/index.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","require","log","type","message","misc","process","env","DEBUG","content","chalk","funcName","getFunctionName","substr","Error","console","info","rest","error","warn","Home","Router","req","res","send","Api","number_rounder","num","isNaN","Number","parseFloat","toFixed","async","countries","JSON","parse","fs","readFileSync","json","country","city","params","sendStatus","uri","encodeURI","html","axios","data","$","cheerio","load","avgTemperature","convert","text","from","to","minTemperature","slice","maxTemperature","responseObject","year","month","browser","puppeteer","launch","page","newPage","goto","waitUntil","result","evaluate","avgMax","document","querySelector","avgAvg","avgMin","max","innerHTML","min","avg","close","config","__webpack_exports__","constructor","_defineProperty","this","err","port","__DEV__","ip","address","toString","app","use","bodyParser","urlencoded","extended","cors","express","static","setRoutes","HttpServer","listen","onListen","PORT","start"],"mappings":"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","file":"main.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 12);\n","module.exports = require(\"chalk\");","module.exports = require(\"express\");","module.exports = require(\"convert-units\");","module.exports = require(\"ip\");","module.exports = require(\"body-parser\");","module.exports = require(\"cors\");","module.exports = require(\"http\");","module.exports = require(\"stack-trace\");","module.exports = require(\"cheerio\");","module.exports = require(\"axios\");","module.exports = require(\"puppeteer\");","module.exports = require(\"fs\");","module.exports = require(\"path\");","module.exports = require(\"dotenv\");","import chalk from 'chalk';\nimport { get } from 'stack-trace';\n\nconst log = (type = 'log', message, ...misc) => {\n    if (type === 'debug' && process.env.DEBUG !== 'true') {\n        return;\n    }\n    let content = [];\n    switch (type) {\n        case 'log':\n            content = [chalk`{bold.cyan INFO}`];\n            break;\n        case 'error':\n            content = [chalk`{bold.red ERR!}`];\n            break;\n        case 'warn':\n            content = [chalk`{bold.yellow WARN}`];\n            break;\n        case 'debug': {\n            const trace = get();\n            const funcName = trace[2].getFunctionName();\n            content = [chalk`{bold.magenta VERB} ${funcName ? chalk`{bgBlack.white  ${funcName.substr(0, 15)} }` : ''}`];\n            break;\n        }\n        default:\n            throw new Error(`Invalid log type: ${type}`);\n    }\n\n    content = [...content, message, ...misc];\n\n    console[type === 'debug' ? 'log' : type](...content);\n};\n\nexport const info = (message, ...rest) => log('log', message, ...rest);\nexport const error = (message, ...rest) => log('error', message, ...rest);\nexport const warn = (message, ...rest) => log('warn', message, ...rest);\nexport const debug = (message, ...rest) => log('debug', message, ...rest);","import { Router } from 'express';\n\nconst Home = Router();\n\nHome.get('/', (req, res) => {\n    res.send('hi from home');\n});\n\nexport default Home;","import {Router} from 'express';\nimport cheerio from 'cheerio';\nimport axios from 'axios';\nimport convert from 'convert-units';\nimport path from 'path';\nimport puppeteer from 'puppeteer';\nimport fs from 'fs';\n\n/*\n* [X] Cities and countries\n* [X] Current temps per city/country\n* [X] Historical temps for city/country\n* */\n\nconst Api = Router();\nconst scrape_url = `https://www.wunderground.com/weather/`;\n\nconst number_rounder = (num) => isNaN(Number(num)) ? 'Not available :(' : parseFloat(num).toFixed(1);\n\nApi.get('/countries-cities', async (req, res) => {\n\tconst countries = JSON.parse(fs.readFileSync('countries-cities.json', 'utf8'));\n\tres.json(countries);\n});\n\n\nApi.get('/current/:country/:city', async (req, res) => {\n\tconst {country, city} = req.params;\n\tif (!country || !city) {\n\t\treturn res.sendStatus(422);\n\t}\n\tconst uri = `${scrape_url}${encodeURI(country)}/${encodeURI(city)}`;\n\tconst html = (await axios.get(uri)).data;\n\tconst $ = cheerio.load(html);\n\tconst avgTemperature = number_rounder(convert($('div.current-temp .wu-value.wu-value-to').text())\n\t\t.from('F')\n\t\t.to('C'))\n\tconst minTemperature = number_rounder($('div.condition-data .hi-lo .lo')\n\t\t.text()\n\t\t.slice(0, -1));\n\tconst maxTemperature = number_rounder($('div.condition-data .hi-lo .hi')\n\t\t.text()\n\t\t.slice(0, -1));\n\n\tconst responseObject = {\n\t\tavgTemperature,\n\t\tminTemperature: minTemperature > -300 ? number_rounder(convert(minTemperature).from('F').to('C')) : minTemperature,\n\t\tmaxTemperature: maxTemperature > -300 ? number_rounder(convert(maxTemperature).from('F').to('C')) : maxTemperature\n\t};\n\tres.json(responseObject);\n});\n\nApi.get('/history/:country/:city/:year/:month', async (req, res) => {\n\tconst { country, city, year, month } = req.params;\n\tif (!country || !city || !year || !month) {\n\t\treturn res.sendStatus(422);\n\t}\n\n\t// We have to use a browser since the data is retrieved via an xhr request\n\tconst browser = await puppeteer.launch();\n\tconst page = await browser.newPage();\n\n\tawait page.goto(`https://www.wunderground.com/history/monthly/${country}/${city}/EHAM/date/${year}-${month}`, {\n\t\twaitUntil: 'networkidle2'\n\t});\n\n\tconst result = await page.evaluate(() => {\n\t\tconst avgMax = document.querySelector('#inner-content > div.city-body > div.row.city-history-summary > div > div:nth-child(1) > div > div > city-history-summary > div > div.summary-table > table > tbody:nth-child(2) > tr:nth-child(2) > td:nth-child(2)');\n\t\tconst avgAvg = document.querySelector('#inner-content > div.city-body > div.row.city-history-summary > div > div:nth-child(1) > div > div > city-history-summary > div > div.summary-table > table > tbody:nth-child(2) > tr:nth-child(2) > td:nth-child(3)');\n\t\tconst avgMin = document.querySelector('#inner-content > div.city-body > div.row.city-history-summary > div > div:nth-child(1) > div > div > city-history-summary > div > div.summary-table > table > tbody:nth-child(2) > tr:nth-child(2) > td:nth-child(4)');\n\n\t\treturn {\n\t\t\tmax: !!avgMax ? avgMax.innerHTML : '--',\n\t\t\tmin: !!avgMin ? avgMin.innerHTML : '--',\n\t\t\tavg: !!avgAvg ? avgMin.innerHTML : '--',\n\t\t};\n\t});\n\n\tbrowser.close();\n\n\tfor (const key in result) {\n\t\tresult[key] = number_rounder(convert(result[key]).from('F').to('C'));\n\t}\n\tres.json(result);\n});\n\nexport default Api;","import bodyParser from 'body-parser';\nimport chalk from 'chalk';\nimport cors from 'cors';\nimport express from 'express';\nimport { Server as HttpServer } from 'http';\nimport ip from 'ip';\nimport { error, info, warn } from './services/log';\nimport Home from \"./controllers/home\";\nimport Api from \"./controllers/api\";\n\nrequire('dotenv').config();\n\n\n/*\n*\n*\n* */\n\nclass Server {\n    app;\n    port;\n\n    constructor () {\n\n        this.app = express();\n        this.port = process.env.PORT || 9321;\n        this.start();\n    }\n\n    onListen = (err) => {\n        if (err) {\n            error(`Unable to start server on port ${this.port}`, err);\n            return;\n        }\n\n        if (process.env.__DEV__) {\n            warn('We\\'re in development mode.');\n        }\n\n        info(`We're live.\\r\\n`);\n        info(chalk`{bold On your network:}     {underline http://${ip.address('public')}:{bold ${this.port.toString()}}/}`);\n        info(chalk`Local:               {underline http://${ip.address('private')}:{bold ${this.port.toString()}}/}`);\n    };\n\n    start = async () => {\n        this.app.use(bodyParser.urlencoded({ extended: true }));\n        this.app.use(cors());\n        this.app.use(express.static('public'));\n        this.setRoutes();\n        const http = new HttpServer(this.app);\n        http.listen(this.port, this.onListen);\n    };\n\n    setRoutes = () => {\n        // this.app.use('/', Home);\n        this.app.use('/api/v1', Api);\n    };\n}\n\nexport default new Server();"],"sourceRoot":""}