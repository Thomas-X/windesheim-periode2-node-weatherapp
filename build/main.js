require("source-map-support/register"),module.exports=function(t){var e={};function r(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)r.d(n,o,function(e){return t[e]}.bind(null,o));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="/",r(r.s=12)}([function(t,e){t.exports=require("chalk")},function(t,e){t.exports=require("express")},function(t,e){t.exports=require("convert-units")},function(t,e){t.exports=require("ip")},function(t,e){t.exports=require("body-parser")},function(t,e){t.exports=require("cors")},function(t,e){t.exports=require("http")},function(t,e){t.exports=require("stack-trace")},function(t,e){t.exports=require("cheerio")},function(t,e){t.exports=require("axios")},function(t,e){t.exports=require("puppeteer")},function(t,e){t.exports=require("fs")},function(t,e,r){t.exports=r(15)},function(t,e){t.exports=require("path")},function(t,e){t.exports=require("dotenv")},function(t,e,r){"use strict";r.r(e);var n=r(4),o=r.n(n),i=r(0),a=r.n(i),s=r(5),u=r.n(s),c=r(1),d=r.n(c),l=r(6),p=r(3),h=r.n(p),y=r(7);const v=(t="log",e,...r)=>{if("debug"===t&&"true"!==process.env.DEBUG)return;let n=[];switch(t){case"log":n=[a.a`{bold.cyan INFO}`];break;case"error":n=[a.a`{bold.red ERR!}`];break;case"warn":n=[a.a`{bold.yellow WARN}`];break;case"debug":{const t=Object(y.get)()[2].getFunctionName();n=[a.a`{bold.magenta VERB} ${t?a.a`{bgBlack.white  ${t.substr(0,15)} }`:""}`];break}default:throw new Error(`Invalid log type: ${t}`)}n=[...n,e,...r],console["debug"===t?"log":t](...n)},f=(t,...e)=>v("log",t,...e),m=(t,...e)=>v("error",t,...e),b=(t,...e)=>v("warn",t,...e),g=Object(c.Router)();g.get("/",(t,e)=>{e.send("hi from home")});var w=r(8),x=r.n(w),q=r(9),j=r.n(q),O=r(2),S=r.n(O),$=(r(13),r(10)),R=r.n($),_=r(11),k=r.n(_);const F=Object(c.Router)(),T=t=>isNaN(Number(t))?"Not available :(":parseFloat(t).toFixed(1);F.get("/countries-cities",async(t,e)=>{const r=JSON.parse(k.a.readFileSync("countries-cities.json","utf8"));e.json(r)}),F.get("/current/:country/:city",async(t,e)=>{const{country:r,city:n}=t.params;if(!r||!n)return e.sendStatus(422);const o=`https://www.wunderground.com/weather/${encodeURI(r)}/${encodeURI(n)}`,i=(await j.a.get(o)).data,a=x.a.load(i),s=T(S()(a("div.current-temp .wu-value.wu-value-to").text()).from("F").to("C")),u=T(a("div.condition-data .hi-lo .lo").text().slice(0,-1)),c=T(a("div.condition-data .hi-lo .hi").text().slice(0,-1)),d={avgTemperature:s,minTemperature:u>-300?T(S()(u).from("F").to("C")):u,maxTemperature:c>-300?T(S()(c).from("F").to("C")):c};e.json(d)}),F.get("/history/:country/:city/:year/:month",async(t,e)=>{const{country:r,city:n,year:o,month:i}=t.params;if(!(r&&n&&o&&i))return e.sendStatus(422);const a=await R.a.launch(),s=await a.newPage();await s.goto(`https://www.wunderground.com/history/monthly/${r}/${n}/EHAM/date/${o}-${i}`,{waitUntil:"networkidle2"});const u=await s.evaluate(()=>{const t=document.querySelector("#inner-content > div.city-body > div.row.city-history-summary > div > div:nth-child(1) > div > div > city-history-summary > div > div.summary-table > table > tbody:nth-child(2) > tr:nth-child(2) > td:nth-child(2)"),e=document.querySelector("#inner-content > div.city-body > div.row.city-history-summary > div > div:nth-child(1) > div > div > city-history-summary > div > div.summary-table > table > tbody:nth-child(2) > tr:nth-child(2) > td:nth-child(3)"),r=document.querySelector("#inner-content > div.city-body > div.row.city-history-summary > div > div:nth-child(1) > div > div > city-history-summary > div > div.summary-table > table > tbody:nth-child(2) > tr:nth-child(2) > td:nth-child(4)");return{max:t?t.innerHTML:"--",min:r?r.innerHTML:"--",avg:e?r.innerHTML:"--"}});a.close();for(const t in u)u[t]=T(S()(u[t]).from("F").to("C"));e.json(u)});var M=F;function N(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}r(14).config();e.default=new class{constructor(){N(this,"app",void 0),N(this,"port",void 0),N(this,"onListen",t=>{t?m(`Unable to start server on port ${this.port}`,t):(process.env.__DEV__&&b("We're in development mode."),f("We're live.\r\n"),f(a.a`{bold On your network:}     {underline http://${h.a.address("public")}:{bold ${this.port.toString()}}/}`),f(a.a`Local:               {underline http://${h.a.address("private")}:{bold ${this.port.toString()}}/}`))}),N(this,"start",async()=>{this.app.use(o.a.urlencoded({extended:!0})),this.app.use(u()()),this.app.use(d.a.static("public")),this.setRoutes(),new l.Server(this.app).listen(this.port,this.onListen)}),N(this,"setRoutes",()=>{this.app.use("/api/v1",M)}),this.app=d()(),this.port=process.env.PORT||9321,this.start()}}}]);
//# sourceMappingURL=main.map